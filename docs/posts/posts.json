[
  {
    "path": "posts/2022-03-24-day-2-hierarchical-and-nonlinear-models/",
    "title": "Day 2: hierarchical and nonlinear models",
    "description": "many groups and curving lines",
    "author": [
      {
        "name": "Andrew MacDonald",
        "url": {}
      }
    ],
    "date": "2022-03-24",
    "categories": [],
    "contents": "\r\nOutline of today:\r\nreturn to previous model: poisson regression\r\npanel regression version of this model\r\nmodel comparison??? (save for tomorrow)\r\nbrief foray into moment matching\r\nnonlinear model\r\nnonlinear model with random effects\r\nQuick review\r\nBird masses\r\nThis example is based on work by Marie-Eve at UdeS!\r\nWe imagine a model like the following:\r\n\\[\r\n\\begin{align}\r\n\\text{Nestlings}_i & \\sim \\text{Poisson}(\\lambda_i) \\\\\r\n\\text{log}(\\lambda_i) &= \\beta_0 + \\beta_1 \\times \\text{Mass}_i \\\\\r\n\\beta_0 & \\sim \\text{Normal}(??, ??) \\\\\r\n\\beta_1 & \\sim \\text{Normal}(??, ??)\r\n\\end{align}\r\n\\]\r\n\\(i\\) keeps track of which bird we are talking about. You can think of it as “bird number i”\r\nNote: We could also write the model like this:\r\n\\[\r\n\\begin{align}\r\n\\text{Nestlings}_i & \\sim \\text{Poisson}(e^{\\beta_0} \\times e^{\\beta_1 \\times \\text{Mass}_i}) \\\\\r\n\\beta_0 & \\sim \\text{Normal}(??, ??) \\\\\r\n\\beta_1 & \\sim \\text{Normal}(??, ??)\r\n\\end{align}\r\n\\]\r\nCentering variables\r\nCentering variables is one of the most important things we can do to help our models be more interpretable. This also helps us to set good priors.\r\nCentering a variable means to subtract the mean from the variable:\r\n\\[\r\n\\begin{align}\r\n\\text{Nestlings}_i & \\sim \\text{Poisson}(\\lambda_i) \\\\\r\n\\text{log}(\\lambda_i) &= \\beta_0 + \\beta_1 \\times (\\text{Mass}_i - \\overline{\\text{Mass}}) \\\\\r\n\\beta_0 & \\sim \\text{Normal}(??, ??) \\\\\r\n\\beta_1 & \\sim \\text{Normal}(??, ??)\r\n\\end{align}\r\n\\] Question How does this change the meaning of \\(\\beta_0\\) and/or \\(\\beta_1\\), if at all? (Hint: what will be the equation for a bird who has exactly average mass?)\r\n\r\n\r\nset.seed(1234)\r\n\r\nn_birds <- 15\r\navg_nestlings_at_avg_mass <- log(4.2)\r\neffect_of_one_gram <- .2\r\n\r\nmother_masses_g <- rnorm(n_birds, mean = 15, sd = 3)\r\navg_mother_mass <- mean(mother_masses_g)\r\n\r\nlog_average_nestlings <- avg_nestlings_at_avg_mass + \r\n  effect_of_one_gram * (mother_masses_g - avg_mother_mass)\r\n\r\nnestlings <- rpois(n = n_birds, lambda = exp(log_average_nestlings))\r\n\r\n\r\n\r\nPlot these to get an idea of it:\r\n\r\n\r\nsuppressPackageStartupMessages(library(tidyverse))\r\nimaginary_birds <- tibble(mother_masses_g, nestlings)\r\n\r\nggplot(imaginary_birds, aes(x = mother_masses_g, y = nestlings)) + \r\n  geom_point()\r\n\r\n\r\n\r\n\r\nNOTE We can also fit this very same model by frequentist statistics, using lm\r\n\r\n\r\ncoef(glm(nestlings ~ 1 + I(mother_masses_g - mean(mother_masses_g)), family = \"poisson\"))\r\n\r\n\r\n                               (Intercept) \r\n                                 1.4138103 \r\nI(mother_masses_g - mean(mother_masses_g)) \r\n                                 0.1727791 \r\n\r\n# compare to known values\r\navg_nestlings_at_avg_mass\r\n\r\n\r\n[1] 1.435085\r\n\r\neffect_of_one_gram\r\n\r\n\r\n[1] 0.2\r\n\r\nBayesian workflow: define a model and priors\r\n\r\n\r\nlibrary(brms)\r\n\r\nimaginary_birds_centered <- imaginary_birds |> \r\n  mutate(mother_mass_g_cen = mother_masses_g - mean(mother_masses_g))\r\n\r\nbird_form <- bf(nestlings ~ 1 + mother_mass_g_cen, family = poisson(link = \"log\"))\r\n\r\nget_prior(bird_form, data = imaginary_birds_centered)\r\n\r\n\r\n                  prior     class              coef group resp dpar\r\n                 (flat)         b                                  \r\n                 (flat)         b mother_mass_g_cen                \r\n student_t(3, 1.4, 2.5) Intercept                                  \r\n nlpar bound       source\r\n                  default\r\n             (vectorized)\r\n                  default\r\n\r\nWe set a prior for each parameter.\r\n\r\n\r\nbird_priors <- c(\r\n  prior(normal(1, .5), class = \"Intercept\"),\r\n  prior(normal(.1, .1), class = \"b\", coef = \"mother_mass_g_cen\")\r\n)\r\n\r\n\r\n\r\nprior predictive checks\r\n\r\n\r\nprior_predictions <- brm(bird_form,\r\n                         data = imaginary_birds_centered,\r\n                         prior = bird_priors, \r\n                         sample_prior = \"only\", \r\n                         file = \"bird_model\",\r\n                         file_refit = \"on_change\",\r\n                         refresh = FALSE)\r\n\r\n\r\n\r\nplot a few of these\r\n\r\n\r\nlibrary(tidybayes)\r\nimaginary_birds_centered |> \r\n  add_predicted_draws(prior_predictions, ndraws = 6) |> \r\n  ggplot(aes(x = mother_masses_g, y = .prediction)) + geom_point() + facet_wrap(~.draw)\r\n\r\n\r\n\r\n\r\nQuestion are we stat\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-03-24-day-2-hierarchical-and-nonlinear-models/Day2_files/figure-html5/unnamed-chunk-1-1.png",
    "last_modified": "2022-03-24T12:47:03-04:00",
    "input_file": "Day2.knit.md"
  }
]
